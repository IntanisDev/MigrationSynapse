{
	"name": "InstoreView_Stock_CON_Automatico_2",
	"properties": {
		"folder": {
			"name": "Datalake_Levis/InstoreView/02 Consumption"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "InstoreView_Stock_ST_Automatico_2",
						"type": "DatasetReference"
					},
					"name": "source1"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DL_PQT_InstoreView_Stock",
						"type": "DatasetReference"
					},
					"name": "sink1"
				}
			],
			"transformations": [
				{
					"name": "derivedColumn1"
				},
				{
					"name": "select1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          Fecha as string,",
				"          Cod_Cadena as string,",
				"          Rut as string,",
				"          Cadena as string,",
				"          Sub_Cadena as string,",
				"          Region as string,",
				"          Local as string,",
				"          Comuna as string,",
				"          Nombre_de_Local as string,",
				"          Codigo_Local as string,",
				"          Direccion as string,",
				"          Linea as string,",
				"          SKU as string,",
				"          Marca as string,",
				"          Descripcion_Producto as string,",
				"          Genero as string,",
				"          Modelo as string,",
				"          Temporada as string,",
				"          Estilo as string,",
				"          Categoria as string,",
				"          Stock_Locales_en_Unidades as string,",
				"          Stock_CD_en_Unidades as string,",
				"          Stock_Total_en_Unidades as string,",
				"          Venta_ultimos_30_dias_en_Unidades as string,",
				"          Promedio_Diario_Ventas_en_Unidades as string,",
				"          Stock_Sugerido_en_Unidades as string,",
				"          Venta_ultimos_7_dias_Ajuste_en_Unidades as string,",
				"          Dias_Stock_Locales_en_Unidades as string,",
				"          Dias_Stock_CD_en_Unidades as string,",
				"          Dias_Stock_Total_en_Unidades as string,",
				"          Stock_Locales_en_Costos_B2B as string,",
				"          Stock_CD_en_Costos_B2B as string,",
				"          Stock_Total_en_Costos_B2B as string,",
				"          Venta_ultimos_30_dias_en_Costos_B2B as string,",
				"          Promedio_Diario_Ventas_en_Costos_B2B as string,",
				"          Stock_Sugerido_en_Costos_B2B as string,",
				"          Venta_ultimos_7_dias_Ajuste_en_Costos_B2B as string,",
				"          Dias_Stock_Locales_en_Costos_B2B as string,",
				"          Dias_Stock_CD_en_Costos_B2B as string,",
				"          Dias_Stock_Total_en_Costos_B2B as string,",
				"          Stock_Locales_en_Ventas_B2B as string,",
				"          Stock_CD_en_Ventas_B2B as string,",
				"          Stock_Total_en_Ventas_B2B as string,",
				"          Venta_ultimos_30_dias_en_Ventas_B2B as string,",
				"          Promedio_Diario_Ventas_en_Ventas_B2B as string,",
				"          Stock_Sugerido_en_Ventas_B2B as string,",
				"          Venta_ultimos_7_dias_Ajuste_en_Ventas_B2B as string,",
				"          Dias_Stock_Locales_en_Ventas_B2B as string,",
				"          Dias_Stock_CD_en_Ventas_B2B as string,",
				"          Dias_Stock_Total_en_Ventas_B2B as string,",
				"          Stock_Locales_en_Ventas_PVP_s_IVA as string,",
				"          Stock_CD_en_Ventas_PVP_s_IVA as string,",
				"          Stock_Total_en_Ventas_PVP_s_IVA as string,",
				"          Venta_ultimos_30_dias_en_Ventas_PVP_s_IVA as string,",
				"          Promedio_Diario_Ventas_en_Ventas_PVP_s_IVA as string,",
				"          Stock_Sugerido_en_Ventas_PVP_s_IVA as string,",
				"          Venta_ultimos_7_dias_Ajuste_en_Ventas_PVP_s_IVA as string,",
				"          Dias_Stock_Locales_en_Ventas_PVP_s_IVA as string,",
				"          Dias_Stock_CD_en_Ventas_PVP_s_IVA as string,",
				"          Dias_Stock_Total_en_Ventas_PVP_s_IVA as string,",
				"          Mix_en_Unidades as string,",
				"          Quiebres as string,",
				"          Stock_en_Transito_en_Unidades as string,",
				"          bukrs as string,",
				"          kunnr as string,",
				"          paledger as string,",
				"          waerk as string,",
				"          cadena as string,",
				"          descadena as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> source1",
				"source1 derive(Stock_Locales_en_Unidades = toDecimal(Stock_Locales_en_Unidades,21,6),",
				"          Stock_CD_en_Unidades = toDecimal(Stock_CD_en_Unidades,21,6),",
				"          Stock_Total_en_Unidades = toDecimal(Stock_Total_en_Unidades,21,6),",
				"          Venta_ultimos_30_dias_en_Unidades = toDecimal(Venta_ultimos_30_dias_en_Unidades,21,6),",
				"          Promedio_Diario_Ventas_en_Unidades = toDecimal(Promedio_Diario_Ventas_en_Unidades,21,6),",
				"          Stock_Sugerido_en_Unidades = toDecimal(Stock_Sugerido_en_Unidades,21,6),",
				"          Venta_ultimos_7_dias_Ajuste_en_Unidades = toDecimal(Venta_ultimos_7_dias_Ajuste_en_Unidades,21,6),",
				"          Dias_Stock_Locales_en_Unidades = toDecimal(Dias_Stock_Locales_en_Unidades,21,6),",
				"          Dias_Stock_CD_en_Unidades = toDecimal(Dias_Stock_CD_en_Unidades,21,6),",
				"          Dias_Stock_Total_en_Unidades = toDecimal(Dias_Stock_Total_en_Unidades,21,6),",
				"          Stock_Locales_en_Costos_B2B = toDecimal(Stock_Locales_en_Costos_B2B,21,6),",
				"          Stock_CD_en_Costos_B2B = toDecimal(Stock_CD_en_Costos_B2B,21,6),",
				"          Stock_Total_en_Costos_B2B = toDecimal(Stock_Total_en_Costos_B2B,21,6),",
				"          Venta_ultimos_30_dias_en_Costos_B2B = toDecimal(Venta_ultimos_30_dias_en_Costos_B2B,21,6),",
				"          Promedio_Diario_Ventas_en_Costos_B2B = toDecimal(Promedio_Diario_Ventas_en_Costos_B2B,21,6),",
				"          Stock_Sugerido_en_Costos_B2B = toDecimal(Stock_Sugerido_en_Costos_B2B,21,6),",
				"          Venta_ultimos_7_dias_Ajuste_en_Costos_B2B = toDecimal(Venta_ultimos_7_dias_Ajuste_en_Costos_B2B,21,6),",
				"          Dias_Stock_Locales_en_Costos_B2B = toDecimal(Dias_Stock_Locales_en_Costos_B2B,21,6),",
				"          Dias_Stock_CD_en_Costos_B2B = toDecimal(Dias_Stock_CD_en_Costos_B2B,21,6),",
				"          Dias_Stock_Total_en_Costos_B2B = toDecimal(Dias_Stock_Total_en_Costos_B2B,21,6),",
				"          Stock_Locales_en_Ventas_B2B = toDecimal(Stock_Locales_en_Ventas_B2B,21,6),",
				"          Stock_CD_en_Ventas_B2B = toDecimal(Stock_CD_en_Ventas_B2B,21,6),",
				"          Stock_Total_en_Ventas_B2B = toDecimal(Stock_Total_en_Ventas_B2B,21,6),",
				"          Venta_ultimos_30_dias_en_Ventas_B2B = toDecimal(Venta_ultimos_30_dias_en_Ventas_B2B,21,6),",
				"          Promedio_Diario_Ventas_en_Ventas_B2B = toDecimal(Promedio_Diario_Ventas_en_Ventas_B2B,21,6),",
				"          Stock_Sugerido_en_Ventas_B2B = toDecimal(Stock_Sugerido_en_Ventas_B2B,21,6),",
				"          Venta_ultimos_7_dias_Ajuste_en_Ventas_B2B = toDecimal(Venta_ultimos_7_dias_Ajuste_en_Ventas_B2B,21,6),",
				"          Dias_Stock_Locales_en_Ventas_B2B = toDecimal(Dias_Stock_Locales_en_Ventas_B2B,21,6),",
				"          Dias_Stock_CD_en_Ventas_B2B = toDecimal(Dias_Stock_CD_en_Ventas_B2B,21,6),",
				"          Dias_Stock_Total_en_Ventas_B2B = toDecimal(Dias_Stock_Total_en_Ventas_B2B,21,6),",
				"          Stock_Locales_en_Ventas_PVP_s_IVA = toDecimal(Stock_Locales_en_Ventas_PVP_s_IVA,21,6),",
				"          Stock_CD_en_Ventas_PVP_s_IVA = toDecimal(Stock_CD_en_Ventas_PVP_s_IVA,21,6),",
				"          Stock_Total_en_Ventas_PVP_s_IVA = toDecimal(Stock_Total_en_Ventas_PVP_s_IVA,21,6),",
				"          Venta_ultimos_30_dias_en_Ventas_PVP_s_IVA = toDecimal(Venta_ultimos_30_dias_en_Ventas_PVP_s_IVA,21,6),",
				"          Promedio_Diario_Ventas_en_Ventas_PVP_s_IVA = toDecimal(Promedio_Diario_Ventas_en_Ventas_PVP_s_IVA,21,6),",
				"          Stock_Sugerido_en_Ventas_PVP_s_IVA = toDecimal(Stock_Sugerido_en_Ventas_PVP_s_IVA,21,6),",
				"          Venta_ultimos_7_dias_Ajuste_en_Ventas_PVP_s_IVA = toDecimal(Venta_ultimos_7_dias_Ajuste_en_Ventas_PVP_s_IVA,21,6),",
				"          Dias_Stock_Locales_en_Ventas_PVP_s_IVA = toDecimal(Dias_Stock_Locales_en_Ventas_PVP_s_IVA,21,6),",
				"          Dias_Stock_CD_en_Ventas_PVP_s_IVA = toDecimal(Dias_Stock_CD_en_Ventas_PVP_s_IVA,21,6),",
				"          Dias_Stock_Total_en_Ventas_PVP_s_IVA = toDecimal(Dias_Stock_Total_en_Ventas_PVP_s_IVA,21,6),",
				"          Mix_en_Unidades = toDecimal(Mix_en_Unidades,21,6),",
				"          Quiebres = toDecimal(Quiebres,21,6),",
				"          Stock_en_Transito_en_Unidades = toDecimal(Stock_en_Transito_en_Unidades,21,6)) ~> derivedColumn1",
				"derivedColumn1 select(mapColumn(",
				"          Fecha,",
				"          Cod_Cadena,",
				"          Rut,",
				"          Cadena = source1@Cadena,",
				"          Sub_Cadena,",
				"          Region,",
				"          Local,",
				"          Comuna,",
				"          Nombre_de_Local,",
				"          Codigo_Local,",
				"          Direccion,",
				"          Linea,",
				"          SKU,",
				"          Marca,",
				"          Descripcion_Producto,",
				"          Genero,",
				"          Modelo,",
				"          Temporada,",
				"          Estilo,",
				"          Categoria,",
				"          Stock_Locales_en_Unidades,",
				"          Stock_CD_en_Unidades,",
				"          Stock_Total_en_Unidades,",
				"          Venta_ultimos_30_dias_en_Unidades,",
				"          Promedio_Diario_Ventas_en_Unidades,",
				"          Stock_Sugerido_en_Unidades,",
				"          Venta_ultimos_7_dias_Ajuste_en_Unidades,",
				"          Dias_Stock_Locales_en_Unidades,",
				"          Dias_Stock_CD_en_Unidades,",
				"          Dias_Stock_Total_en_Unidades,",
				"          Stock_Locales_en_Costos_B2B,",
				"          Stock_CD_en_Costos_B2B,",
				"          Stock_Total_en_Costos_B2B,",
				"          Venta_ultimos_30_dias_en_Costos_B2B,",
				"          Promedio_Diario_Ventas_en_Costos_B2B,",
				"          Stock_Sugerido_en_Costos_B2B,",
				"          Venta_ultimos_7_dias_Ajuste_en_Costos_B2B,",
				"          Dias_Stock_Locales_en_Costos_B2B,",
				"          Dias_Stock_CD_en_Costos_B2B,",
				"          Dias_Stock_Total_en_Costos_B2B,",
				"          Stock_Locales_en_Ventas_B2B,",
				"          Stock_CD_en_Ventas_B2B,",
				"          Stock_Total_en_Ventas_B2B,",
				"          Venta_ultimos_30_dias_en_Ventas_B2B,",
				"          Promedio_Diario_Ventas_en_Ventas_B2B,",
				"          Stock_Sugerido_en_Ventas_B2B,",
				"          Venta_ultimos_7_dias_Ajuste_en_Ventas_B2B,",
				"          Dias_Stock_Locales_en_Ventas_B2B,",
				"          Dias_Stock_CD_en_Ventas_B2B,",
				"          Dias_Stock_Total_en_Ventas_B2B,",
				"          Stock_Locales_en_Ventas_PVP_s_IVA,",
				"          Stock_CD_en_Ventas_PVP_s_IVA,",
				"          Stock_Total_en_Ventas_PVP_s_IVA,",
				"          Venta_ultimos_30_dias_en_Ventas_PVP_s_IVA,",
				"          Promedio_Diario_Ventas_en_Ventas_PVP_s_IVA,",
				"          Stock_Sugerido_en_Ventas_PVP_s_IVA,",
				"          Venta_ultimos_7_dias_Ajuste_en_Ventas_PVP_s_IVA,",
				"          Dias_Stock_Locales_en_Ventas_PVP_s_IVA,",
				"          Dias_Stock_CD_en_Ventas_PVP_s_IVA,",
				"          Dias_Stock_Total_en_Ventas_PVP_s_IVA,",
				"          Mix_en_Unidades,",
				"          Quiebres,",
				"          Stock_en_Transito_en_Unidades,",
				"          bukrs,",
				"          kunnr,",
				"          paledger,",
				"          waerk,",
				"          codcadena = source1@cadena,",
				"          descadena",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'parquet',",
				"     partitionFileNames:[(concat('InstoreView_Stock_', toString(addDays(currentUTC(),-2),'yyyyMMdd'), '.parquet'))],",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sink1"
			]
		}
	}
}